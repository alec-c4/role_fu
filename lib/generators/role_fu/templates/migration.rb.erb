# frozen_string_literal: true

class RoleFuCreate<%= table_name.camelize %> < ActiveRecord::Migration<%= migration_version %>
  def change
    create_table :<%= table_name %> do |t|
      t.string :name
      t.references :resource, polymorphic: true, index: true

      t.timestamps
    end

    create_table :<%= table_name.singularize %>_assignments do |t|
      t.references :<%= user_cname.underscore %>, index: true
      t.references :<%= table_name.singularize %>, index: true

      t.timestamps
    end
    
    add_index(:<%= table_name %>, [ :name, :resource_type, :resource_id ])
    add_index(:<%= table_name.singularize %>_assignments, [ :<%= user_cname.underscore %>_id, :<%= table_name.singularize %>_id ], name: 'index_role_fu_assignments_on_user_and_role', unique: true)
  end
end
